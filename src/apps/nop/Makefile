# Compiler
COMPILER = gcc
COMPILER_CODE32_OPTION = -m32
COMPILER_DONT_LINK_OPTION = -c
COMPILER_OUTPUT_ASSEMBLY_OPTION = -S
COMPILER_OUTPUT_OPTION = -o
COMPILER_WARNING_OPTION = -Wall -Wextra

# Linker
LINKER = ld
LINKER_I386_OPTION = -m elf_i386
LINKER_MAP_OPTION = -Map nop.map
LINKER_OUTPUT_OPTION = -o

SOURCE = nop.c
ASSEMBLY = $(SOURCE:.c=.s)
OBJECTS = $(ASSEMBLY:.s=.o)

all: nop.elf

nop.elf: $(OBJECTS)
	$(LINKER) $^ $(LINKER_I386_OPTION) $(LINKER_MAP_OPTION) $(LINKER_OUTPUT_OPTION) $@

$(OBJECTS): $(@:.o=.s)

$(ASSEMBLY): $(@:.s=.c)

%.o: %.s
	$(COMPILER) $^ $(COMPILER_CODE32_OPTION) $(COMPILER_DONT_LINK_OPTION) $(COMPILER_OUTPUT_OPTION) $@ $(COMPILER_WARNING_OPTION)

%.s: %.c
	$(COMPILER) $^ $(COMPILER_CODE32_OPTION) $(COMPILER_OUTPUT_ASSEMBLY_OPTION) $(COMPILER_OUTPUT_OPTION) $@ $(COMPILER_WARNING_OPTION)

# Don't remove intermediate files
.PRECIOUS: %.elf %.o %.s

